if(window.chatInitialized);else{function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function getLocalTime(){return(new Date).toLocaleString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"})}window.chatInitialized=!0,document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("chat-container"),t=document.getElementById("chat-toggle"),n=document.getElementById("minimize-btn"),s=document.getElementById("close-btn"),o=document.getElementById("chat-input"),i=document.getElementById("send-btn"),a=document.getElementById("chat-messages");if(!t||!e)return;let c;c="vrdistribucion.com"===window.location.hostname?"https://vrdistribucion.com/api/chat":"www.vrdistribucion.com"===window.location.hostname?"https://www.vrdistribucion.com/api/chat":"http://localhost:8000/api/chat";let r=[];async function l(){const e=o.value.trim();if(e){u(e,"user"),r.push({role:"user",content:e}),o.value="";try{const t=u("Typing...","assistant"),n=new Promise(((e,t)=>{setTimeout((()=>t(new Error("Timeout"))),3e4)})),s=fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:e,conversation_history:r,sessionId:generateUUID(),timestamp:getLocalTime()})}),o=await Promise.race([s,n]);if(t.remove(),!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const i=await o.text();let a;try{if(a=JSON.parse(i),a&&a.response)u(a.response,"assistant"),r.push({role:"assistant",content:a.response});else{const e=JSON.stringify(a,null,2);u(e,"assistant"),r.push({role:"assistant",content:e})}}catch(e){u(i,"assistant"),r.push({role:"assistant",content:i})}}catch(e){const t=a.querySelector(".message.assistant:last-child");t&&t.textContent.includes("Typing...")&&t.remove();u("Timeout"===e.message?"La solicitud tardó demasiado tiempo. Por favor, intenta de nuevo.":e.message.includes("Failed to fetch")?"No se pudo conectar al servidor. Por favor, verifica tu conexión e intenta de nuevo.":"Lo siento, hubo un error al procesar tu mensaje. Por favor, intenta de nuevo.","assistant")}}}t.addEventListener("click",(()=>{e.classList.toggle("collapsed"),e.classList.contains("collapsed")?t.style.display="block":t.style.display="none"})),n.addEventListener("click",(()=>{e.classList.add("collapsed"),t.style.display="block"})),s.addEventListener("click",(()=>{e.classList.add("collapsed"),t.style.display="block"}));const d=new showdown.Converter;function u(e,t){const n=d.makeHtml(e),s=document.createElement("div");return s.className=`message ${t}`,s.innerHTML=`\n            <div class="message-content">\n                ${n}\n            </div>\n        `,a.appendChild(s),a.scrollTop=a.scrollHeight,s}i.addEventListener("click",l),o.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),l())})),o.addEventListener("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}))}))}