function createParticles(){const e=document.getElementById("particles");for(let t=0;t<50;t++){const t=document.createElement("div");t.className="particle",t.style.left=100*Math.random()+"%",t.style.animationDelay=6*Math.random()+"s",t.style.animationDuration=3*Math.random()+3+"s",e.appendChild(t)}}const ValidationUtils={sanitizeText:e=>e?e.trim().replace(/[<>]/g,"").replace(/\s+/g," ").substring(0,500):"",normalizeName:e=>e?e.trim().replace(/[^a-zA-Z√°√©√≠√≥√∫√º√±√Å√â√ç√ì√ö√ú√ë\s]/g,"").replace(/\s+/g," ").toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ").substring(0,100):"",validateEmail:e=>{if(!e)return{valid:!1,normalized:""};const t=e.trim().toLowerCase();return{valid:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)&&t.length<=254,normalized:t}},normalizePhone:e=>{if(!e)return"";let t=e.replace(/\D/g,"");if(10===t.length)t="52"+t;else if(12===t.length&&t.startsWith("52"))t=t;else{if(13!==t.length||!t.startsWith("521"))return"";t=t}return t},validateEventDate:e=>{if(!e)return{valid:!0,message:""};const t=new Date(e),a=new Date,n=new Date;return n.setFullYear(a.getFullYear()+2),t<a?{valid:!1,message:"La fecha del evento debe ser futura"}:t>n?{valid:!1,message:"La fecha del evento no puede ser m√°s de 2 a√±os adelante"}:{valid:!0,message:""}},sanitizeMessage:e=>e?e.trim().replace(/[<>]/g,"").replace(/\s+/g," ").substring(0,2e3):""};function setupRealTimeValidation(){document.getElementById("nombre").addEventListener("input",(function(){this.value=ValidationUtils.normalizeName(this.value),validateField(this)}));document.getElementById("email").addEventListener("blur",(function(){const e=ValidationUtils.validateEmail(this.value);this.value=e.normalized,!e.valid&&this.value?showFieldError(this,"Por favor ingresa un email v√°lido"):clearFieldError(this)}));const e=document.getElementById("telefono");e.addEventListener("input",(function(){this.value=this.value.replace(/[^\d\s()-]/g,"")})),e.addEventListener("blur",(function(){const e=ValidationUtils.normalizePhone(this.value);this.value&&!e?showFieldError(this,"Por favor ingresa un tel√©fono mexicano v√°lido"):(clearFieldError(this),e&&(this.value=formatPhoneDisplay(e)))}));document.getElementById("fechaEvento").addEventListener("change",(function(){const e=ValidationUtils.validateEventDate(this.value);e.valid?clearFieldError(this):showFieldError(this,e.message)}));document.getElementById("mensaje").addEventListener("input",(function(){this.value=this.value.substring(0,2e3);const e=this.parentNode.querySelector(".char-counter")||document.createElement("div");e.className="char-counter",e.style.cssText="font-size: 0.8rem; color: #6b7280; text-align: right; margin-top: 0.5rem;",e.textContent=`${this.value.length}/2000 caracteres`,this.parentNode.querySelector(".char-counter")||this.parentNode.appendChild(e)}))}function validateField(e){return e.hasAttribute("required")&&!e.value.trim()?(showFieldError(e,"Este campo es obligatorio"),!1):(clearFieldError(e),!0)}function showFieldError(e,t){clearFieldError(e),e.style.borderColor="#ef4444";const a=document.createElement("div");a.className="field-error",a.style.cssText="color: #ef4444; font-size: 0.8rem; margin-top: 0.25rem;",a.textContent=t,e.parentNode.appendChild(a)}function clearFieldError(e){e.style.borderColor="";const t=e.parentNode.querySelector(".field-error");t&&t.remove()}function formatPhoneDisplay(e){return 12===e.length?`+${e.substring(0,2)} ${e.substring(2,5)} ${e.substring(5,8)} ${e.substring(8)}`:e}function validateForm(e){const t=[];(!e.get("nombre")||e.get("nombre").trim().length<2)&&t.push("El nombre debe tener al menos 2 caracteres");ValidationUtils.validateEmail(e.get("email")).valid||t.push("Por favor ingresa un email v√°lido");ValidationUtils.normalizePhone(e.get("telefono"))||t.push("Por favor ingresa un tel√©fono mexicano v√°lido"),e.get("tipoEvento")||t.push("Por favor selecciona el tipo de evento");if(0===document.querySelectorAll('input[name="servicios[]"]:checked').length&&t.push("Por favor selecciona al menos un servicio de inter√©s"),e.get("privacidad")||t.push("Debes aceptar el tratamiento de datos personales"),e.get("fechaEvento")){const a=ValidationUtils.validateEventDate(e.get("fechaEvento"));a.valid||t.push(a.message)}return t}function prepareDataForSubmission(e){const t={};t.nombre=ValidationUtils.normalizeName(e.get("nombre")),t.email=ValidationUtils.validateEmail(e.get("email")).normalized,t.telefono=ValidationUtils.normalizePhone(e.get("telefono")),t.ciudad=ValidationUtils.sanitizeText(e.get("ciudad")),t.tipoEvento=e.get("tipoEvento"),t.fechaEvento=e.get("fechaEvento")||null,t.invitados=e.get("invitados")||null,t.presupuesto=e.get("presupuesto")||null,t.mensaje=ValidationUtils.sanitizeMessage(e.get("mensaje"));const a=Array.from(document.querySelectorAll('input[name="servicios[]"]:checked')).map((e=>e.value));return t.servicios=a,t.timestamp=(new Date).toISOString(),t.userAgent=navigator.userAgent.substring(0,200),t.referrer=document.referrer.substring(0,200),t}function showSuccessScreen(e,t){const a=document.querySelector(".form-container"),n=document.getElementById("successScreen");a.style.transition="all 0.5s ease",a.style.transform="translateY(-50px)",a.style.opacity="0",setTimeout((()=>{a.style.display="none",n.style.display="block",n.style.opacity="0",setTimeout((()=>{n.style.transition="opacity 0.5s ease",n.style.opacity="1",displayAIMessage(e,t)}),100)}),500)}function displayAIMessage(e,t){const a=document.getElementById("aiMessage"),n=document.getElementById("eventDetails");setTimeout((()=>{a.innerHTML="";let i=`¬°Gracias ${e.nombre}! Hemos recibido tu solicitud para tu ${e.tipoEvento}. Te contactaremos pronto para hacer realidad tu evento so√±ado.`;Array.isArray(t)&&t.length>0&&t[0].output?i=t[0].output:t&&"object"==typeof t&&t.output&&(i=t.output),a.innerHTML=`\n          <h3>ü§ñ Gracias >${e.nombre}</h3>\n          <p>${i}</p>\n        `,showEventDetails(e,n)}),2500)}function showEventDetails(e,t){var a,n,i;t.innerHTML=`\n        <div class="event-detail">\n          <div class="event-detail-label">Cliente</div>\n          <div class="event-detail-value">${e.nombre}</div>\n        </div>\n        <div class="event-detail">\n          <div class="event-detail-label">Tipo de Evento</div>\n          <div class="event-detail-value">${e.tipoEvento.charAt(0).toUpperCase()+e.tipoEvento.slice(1)}</div>\n        </div>\n        <div class="event-detail">\n          <div class="event-detail-label">Fecha</div>\n          <div class="event-detail-value">${i=e.fechaEvento,i?new Date(i).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Por definir"}</div>\n        </div>\n        <div class="event-detail">\n          <div class="event-detail-label">Invitados</div>\n          <div class="event-detail-value">${n=e.invitados,n||"Por definir"}</div>\n        </div>\n        <div class="event-detail">\n          <div class="event-detail-label">Presupuesto</div>\n          <div class="event-detail-value">${a=e.presupuesto,a||"Por definir"}</div>\n        </div>\n        <div class="event-detail email-detail">\n          <div class="event-detail-label">Email</div>\n          <div class="event-detail-value" style="word-break: break-all;">${e.email}</div>\n        </div>\n      `,t.style.display="grid",t.style.gridTemplateColumns="repeat(auto-fit, minmax(200px, 1fr))",t.style.gap="1rem",t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout((()=>{t.style.transition="all 0.5s ease",t.style.opacity="1",t.style.transform="translateY(0)"}),500);const o=t.querySelector(".email-detail .event-detail-value");o&&(o.style.whiteSpace="normal",o.style.overflowWrap="break-word",o.style.wordBreak="break-all")}document.getElementById("contactForm").addEventListener("submit",(function(e){e.preventDefault();const t=this.querySelector(".submit-button"),a=t.textContent;t.disabled=!0,t.textContent="Enviando...";try{const e=new FormData(this),n=validateForm(e);if(n.length>0)return alert("Por favor corrige los siguientes errores:\n\n"+n.join("\n")),t.disabled=!1,void(t.textContent=a);const i=prepareDataForSubmission(e);let o;"vrdistribucion.com"===window.location.hostname?o="https://vrdistribucion.com/api/cotizaciones":"www.vrdistribucion.com"===window.location.hostname?o="https://www.vrdistribucion.com/api/cotizaciones":"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||(o="http://localhost:8000/api/cotizaciones"),fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{showSuccessScreen(i,e)})).catch((e=>{alert("Hubo un problema al enviar tu solicitud. Por favor verifica tu conexi√≥n e intenta de nuevo, o cont√°ctanos directamente por WhatsApp."),t.disabled=!1,t.textContent=a}))}catch(e){alert("Ocurri√≥ un error inesperado. Por favor intenta nuevamente."),t.disabled=!1,t.textContent=a}})),document.addEventListener("DOMContentLoaded",(function(){createParticles(),setupRealTimeValidation(),window.addEventListener("scroll",(function(){const e=document.querySelector(".header");window.scrollY>50?(e.style.height="60px",e.style.background="rgba(255, 255, 255, 0.15)"):(e.style.height="70px",e.style.background="rgba(255, 255, 255, 0.1)")}))}));