class GalleryManager{constructor(){this.currentGallery="masonry",this.currentImageIndex=0,this.images=[],this.isLightboxOpen=!1,this.focusedElementBeforeLightbox=null,this.container=document.querySelector("main")||document.body,this.lightboxOverlay=null,this.lightboxImage=null,this.lightboxTitle=null,this.lightboxDescription=null,this.lightboxCounter=null,this.galleryTabs=null,this.gallerySections=null,this.init()}init(){document.body.style.overflow="",document.documentElement.style.overflow="",this.container&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.setup())):this.setup())}setup(){document.body.style.overflow="",document.documentElement.style.overflow="",this.cacheDOMElements(),this.createLightboxHTML(),this.setupEventListeners(),this.setupTabNavigation(),this.setDefaultGalleryForDevice(),this.collectImages(),this.setupImageClickListeners(),setTimeout((()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}),100)}setDefaultGalleryForDevice(){this.switchGallery("masonry")}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}cacheDOMElements(){this.galleryTabs=document.querySelectorAll(".gallery-tab"),this.gallerySections=document.querySelectorAll(".gallery-section")}createLightboxHTML(){this.lightboxOverlay=document.getElementById("lightbox-overlay"),this.lightboxOverlay&&(this.lightboxImage=document.getElementById("lightbox-image"),this.lightboxTitle=document.getElementById("lightbox-title"),this.lightboxDescription=document.getElementById("lightbox-description"),this.lightboxCounter=document.getElementById("lightbox-counter"))}setupEventListeners(){this.setupLightboxControls(),this.setupKeyboardNavigation(),window.addEventListener("resize",(()=>this.handleResize()))}setupImageClickListeners(){this.removeImageClickListeners();const e=document.querySelector(".gallery-section.active");if(!e)return;e.querySelectorAll(".gl-item").forEach(((e,t)=>{const i=e=>this.openLightbox(t),s=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.openLightbox(t))};e._clickHandler=i,e._keydownHandler=s,e.addEventListener("click",i),e.addEventListener("keydown",s),e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label",`Ver imagen: ${e.dataset.title||"Proyecto VR Distribución"}`),e.complete?e.classList.add("loaded"):(e.addEventListener("load",(()=>{e.classList.add("loaded")})),e.addEventListener("error",(()=>{e.classList.add("error")})))}))}removeImageClickListeners(){document.querySelectorAll(".gl-item").forEach((e=>{e._clickHandler&&(e.removeEventListener("click",e._clickHandler),delete e._clickHandler),e._keydownHandler&&(e.removeEventListener("keydown",e._keydownHandler),delete e._keydownHandler)}))}setupLightboxControls(){if(!this.lightboxOverlay)return;const e=this.lightboxOverlay.querySelector(".lightbox-close");e&&e.addEventListener("click",(()=>this.closeLightbox()));const t=this.lightboxOverlay.querySelector(".lightbox-prev"),i=this.lightboxOverlay.querySelector(".lightbox-next");t&&t.addEventListener("click",(()=>this.navigateImage(-1))),i&&i.addEventListener("click",(()=>this.navigateImage(1))),this.lightboxOverlay.addEventListener("click",(e=>{e.target===this.lightboxOverlay&&this.closeLightbox()})),this.setupTouchGestures()}setupTouchGestures(){if(!this.lightboxOverlay)return;let e=0,t=0,i=0,s=0;this.lightboxOverlay.addEventListener("touchstart",(i=>{if(!this.isLightboxOpen)return;const s=i.touches[0];e=s.clientX,t=s.clientY}),{passive:!0}),this.lightboxOverlay.addEventListener("touchend",(n=>{if(!this.isLightboxOpen)return;const o=n.changedTouches[0];i=o.clientX,s=o.clientY,this.handleSwipeGesture(e,t,i,s)}),{passive:!0})}handleSwipeGesture(e,t,i,s){const n=i-e,o=s-t;Math.abs(n)>50&&Math.abs(o)<100?n>0?this.navigateImage(-1):this.navigateImage(1):Math.abs(o)>50&&Math.abs(n)<100&&o>0&&this.closeLightbox()}setupKeyboardNavigation(){document.addEventListener("keydown",(e=>{if(this.isLightboxOpen)switch(e.key){case"Escape":e.preventDefault(),this.closeLightbox();break;case"ArrowLeft":e.preventDefault(),this.navigateImage(-1);break;case"ArrowRight":e.preventDefault(),this.navigateImage(1);break;case"Home":e.preventDefault(),this.navigateToImage(0);break;case"End":e.preventDefault(),this.navigateToImage(this.images.length-1);break}}))}setupTabNavigation(){this.galleryTabs.forEach((e=>{e.addEventListener("click",(()=>{this.switchGallery(e.dataset.gallery)})),e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.switchGallery(e.dataset.gallery))}))}))}switchGallery(e){this.galleryTabs.forEach((t=>{const i=t.dataset.gallery===e;t.classList.toggle("active",i),t.setAttribute("aria-selected",i)})),this.gallerySections.forEach((t=>{const i=t.id===`${e}-gallery`;t.classList.toggle("active",i)})),this.currentGallery=e,this.collectImages(),this.setupImageClickListeners(),this.announceGalleryChange(e)}announceGalleryChange(e){const t={masonry:"Mostrando galería de proyectos destacados con diseño masonry",hexagon:"Mostrando galería hexagonal de proyectos",polaroid:"Mostrando galería estilo polaroid de proyectos"}[e]||"Galería cambiada";this.announceToScreenReader(t)}collectImages(){const e=document.querySelector(".gallery-section.active");if(!e)return void(this.images=[]);const t=e.querySelectorAll(".gl-item");this.images=Array.from(t).map(((e,t)=>(e.src,{element:e,src:e.src||"",alt:e.alt||"Imagen de galería",title:e.dataset.title||`Proyecto ${t+1}`,category:e.dataset.category||"VR Distribución",index:t}))).filter((e=>e.src))}setBodyScroll(e=!0){e?(document.body.style.overflow="",document.documentElement.style.overflow=""):this.isLightboxOpen&&(document.body.style.overflow="hidden")}openLightbox(e){this.images&&0!==this.images.length&&(this.focusedElementBeforeLightbox=document.activeElement,this.currentImageIndex=e,this.isLightboxOpen=!0,this.setBodyScroll(!1),this.lightboxOverlay.classList.add("active"),this.lightboxOverlay.setAttribute("aria-hidden","false"),this.loadLightboxImage())}closeLightbox(){this.isLightboxOpen&&(this.isLightboxOpen=!1,this.setBodyScroll(!0),this.lightboxOverlay.classList.remove("active"),this.lightboxOverlay.setAttribute("aria-hidden","true"),this.focusedElementBeforeLightbox&&(this.focusedElementBeforeLightbox.focus(),this.focusedElementBeforeLightbox=null),this.announceToScreenReader("Galería de imágenes cerrada"))}navigateImage(e){if(!this.isLightboxOpen||!this.images.length)return;const t=this.currentImageIndex+e;t<0?this.navigateToImage(this.images.length-1):t>=this.images.length?this.navigateToImage(0):this.navigateToImage(t)}navigateToImage(e){if(e<0||e>=this.images.length)return;this.currentImageIndex=e,this.loadLightboxImage();const t=this.images[e];this.announceToScreenReader(`Imagen ${e+1} de ${this.images.length}: ${t.title}`)}loadLightboxImage(){if(!this.lightboxImage||!this.images.length)return;const e=this.images[this.currentImageIndex];if(!e||!e.src)return void this.announceToScreenReader("Error: datos de imagen no válidos");const t=new Image;t.onload=()=>{this.lightboxImage.src=t.src,this.lightboxImage.alt=e.alt||"Imagen de galería",this.lightboxTitle&&(this.lightboxTitle.textContent=e.title||"Proyecto VR Distribución"),this.lightboxDescription&&(this.lightboxDescription.textContent=e.category||"VR Distribución"),this.lightboxCounter&&(this.lightboxCounter.textContent=`${this.currentImageIndex+1} de ${this.images.length}`)},t.onerror=()=>{this.announceToScreenReader("Error al cargar la imagen")},t.src=e.src}handleResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.isLightboxOpen,this.checkGalleryForScreenSize()}),250)}checkGalleryForScreenSize(){this.isMobileDevice(),window.innerWidth}announceToScreenReader(e){let t=document.getElementById("gallery-announcer");t||(t=document.createElement("div"),t.id="gallery-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.position="absolute",t.style.left="-10000px",t.style.width="1px",t.style.height="1px",t.style.overflow="hidden",document.body.appendChild(t)),t.textContent="",setTimeout((()=>{t.textContent=e}),100)}getStats(){return{currentGallery:this.currentGallery,totalImages:this.images.length,currentImageIndex:this.currentImageIndex,isLightboxOpen:this.isLightboxOpen}}}class GalleryAnimations{constructor(){this.observers=[],this.init()}init(){this.setupIntersectionObserver(),this.setupScrollAnimations()}setupIntersectionObserver(){if(!("IntersectionObserver"in window))return;const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(t.target.classList.add("animate-in"),e.unobserve(t.target))}))}),{root:null,rootMargin:"0px 0px -100px 0px",threshold:.1}),t=()=>{document.querySelectorAll(".masonry-item, .hexagon-item, .polaroid-item").forEach((t=>{t.classList.contains("animate-in")||e.observe(t)}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),this.observers.push(e)}setupScrollAnimations(){let e=!1;const t=()=>{const t=window.pageYOffset,i=window.innerHeight,s=document.querySelector(".gallery-hero");if(s){const e=s.getBoundingClientRect();if(e.bottom>0&&e.top<i){const e=t*.5;s.style.transform=`translateY(${e}px)`}}e=!1};window.addEventListener("scroll",(()=>{e||(window.requestAnimationFrame(t),e=!0)}),{passive:!0})}destroy(){this.observers.forEach((e=>e.disconnect())),this.observers=[]}}class GalleryPerformance{constructor(){this.metrics={imagesLoaded:0,totalImages:0,loadStartTime:performance.now()},this.init()}init(){this.setupImageLoadTracking(),this.setupPerformanceObserver()}setupImageLoadTracking(){const e=document.querySelectorAll(".gl-item");this.metrics.totalImages=e.length,e.forEach((e=>{e.complete?this.metrics.imagesLoaded++:(e.addEventListener("load",(()=>{this.metrics.imagesLoaded++,this.checkLoadComplete()})),e.addEventListener("error",(()=>{})))})),this.checkLoadComplete()}setupPerformanceObserver(){if("PerformanceObserver"in window)try{new PerformanceObserver((e=>{e.getEntries().forEach((e=>{e.entryType,e.entryType}))})).observe({entryTypes:["largest-contentful-paint","layout-shift"]})}catch(e){}}checkLoadComplete(){if(this.metrics.imagesLoaded>=this.metrics.totalImages){performance.now(),this.metrics.loadStartTime}}getMetrics(){return{...this.metrics,loadTime:performance.now()-this.metrics.loadStartTime}}}class MobileMenuManager{constructor(){this.mobileToggle=null,this.hamburgerDropdown=null,this.nav=null,this.icon=null,this.isInitialized=!1,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.setup())):this.setup()}setup(){this.mobileToggle=document.querySelector(".mobile-menu-toggle"),this.hamburgerDropdown=document.querySelector(".hamburger-dropdown"),this.nav=document.querySelector("header nav"),this.icon=this.mobileToggle?.querySelector("i"),this.mobileToggle&&this.hamburgerDropdown&&this.icon&&(this.setupEventListeners(),this.isInitialized=!0)}setupEventListeners(){this.mobileToggle.addEventListener("click",(e=>this.handleToggleClick(e))),this.setupNavLinkListeners(),this.setupOutsideClickListener(),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.isMenuOpen()&&this.closeMenu()}))}handleToggleClick(e){e.preventDefault(),e.stopPropagation();this.isMenuOpen()?this.closeMenu():this.openMenu()}openMenu(){this.hamburgerDropdown.classList.add("active"),this.icon.className="icon ion-md-close",this.mobileToggle.setAttribute("aria-expanded","true"),this.mobileToggle.setAttribute("aria-label","Cerrar menú"),window.innerWidth<=768&&(document.body.style.overflow="hidden")}closeMenu(){this.hamburgerDropdown.classList.remove("active"),this.icon.className="icon ion-md-menu",this.mobileToggle.setAttribute("aria-expanded","false"),this.mobileToggle.setAttribute("aria-label","Abrir menú"),document.body.style.overflow=""}setupNavLinkListeners(){this.hamburgerDropdown.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(()=>{this.closeMenu()}))}))}setupOutsideClickListener(){document.addEventListener("click",(e=>{!this.isMenuOpen()||this.mobileToggle.contains(e.target)||this.hamburgerDropdown.contains(e.target)||this.closeMenu()}))}isMenuOpen(){return this.hamburgerDropdown?.classList.contains("active")||!1}getState(){return{isInitialized:this.isInitialized,isMenuOpen:this.isMenuOpen(),hasElements:!!(this.mobileToggle&&this.hamburgerDropdown&&this.icon)}}}document.addEventListener("DOMContentLoaded",(()=>{window.galleryManager=new GalleryManager,window.mobileMenuManager=new MobileMenuManager,window.matchMedia("(prefers-reduced-motion: reduce)").matches||(window.galleryAnimations=new GalleryAnimations),window.galleryPerformance=new GalleryPerformance})),window.GalleryManager=GalleryManager,window.GalleryAnimations=GalleryAnimations,window.GalleryPerformance=GalleryPerformance,window.MobileMenuManager=MobileMenuManager;